==6850== Memcheck, a memory error detector
==6850== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
==6850== Using Valgrind-3.14.0 and LibVEX; rerun with -h for copyright info
==6850== Command: ./httpServer.out 8000 0 0 0
==6850== Parent PID: 2898
==6850== 
==6850== Invalid read of size 8
==6850==    at 0x517E9D1: std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::find(char const*, unsigned long, unsigned long) const (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.22)
==6850==    by 0x11600B: find (basic_string.h:2056)
==6850==    by 0x11600B: HttpSession::handleMessage(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (HttpSession.cc:191)
==6850==    by 0x10E764: __invoke_impl<void, void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:227)
==6850==    by 0x10E764: __invoke<void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:251)
==6850==    by 0x10E764: operator()<std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:604)
==6850==    by 0x10E764: __call<void, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, 0ul, 1ul> (functional:934)
==6850==    by 0x10E764: operator()<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:993)
==6850==    by 0x10E764: std::_Function_handler<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_invoke(std::_Any_data const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (functional:1731)
==6850==    by 0x121C45: std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)>::operator()(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) const (functional:2127)
==6850==    by 0x120104: TcpConnection::handleRead() (TcpConnection.cc:132)
==6850==    by 0x1216CC: __invoke_impl<void, void (TcpConnection::* const&)(), TcpConnection*&> (functional:227)
==6850==    by 0x1216CC: __invoke<void (TcpConnection::* const&)(), TcpConnection*&> (functional:251)
==6850==    by 0x1216CC: operator()<TcpConnection*&> (functional:604)
==6850==    by 0x1216CC: __call<void, 0ul> (functional:934)
==6850==    by 0x1216CC: operator()<> (functional:993)
==6850==    by 0x1216CC: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpConnection::*)()> (TcpConnection*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==    by 0x10D04F: std::function<void ()>::operator()() const (functional:2127)
==6850==    by 0x10CF9D: Channel::handleEvent() (Channel.cc:28)
==6850==    by 0x11890C: EventLoop::loop() (EventLoop.cc:121)
==6850==    by 0x10F645: main (main.cc:48)
==6850==  Address 0x5d3d240 is 48 bytes inside a block of size 232 free'd
==6850==    at 0x4C2F4AA: operator delete(void*) (vg_replace_malloc.c:576)
==6850==    by 0x10E98E: deallocate (new_allocator.h:110)
==6850==    by 0x10E98E: deallocate (alloc_traits.h:462)
==6850==    by 0x10E98E: ~__allocated_ptr (allocated_ptr.h:73)
==6850==    by 0x10E98E: std::_Sp_counted_ptr_inplace<HttpSession, std::allocator<HttpSession>, (__gnu_cxx::_Lock_policy)2>::_M_destroy() (shared_ptr_base.h:537)
==6850==    by 0x10EAD7: _M_release (shared_ptr_base.h:166)
==6850==    by 0x10EAD7: ~__shared_count (shared_ptr_base.h:662)
==6850==    by 0x10EAD7: ~__shared_ptr (shared_ptr_base.h:928)
==6850==    by 0x10EAD7: ~shared_ptr (shared_ptr.h:93)
==6850==    by 0x10EAD7: ~_Head_base (tuple:102)
==6850==    by 0x10EAD7: ~_Tuple_impl (tuple:180)
==6850==    by 0x10EAD7: ~tuple (tuple:866)
==6850==    by 0x10EAD7: ~_Bind (functional:918)
==6850==    by 0x10EAD7: _M_destroy (functional:1586)
==6850==    by 0x10EAD7: std::_Function_base::_Base_manager<std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_manager(std::_Any_data&, std::_Any_data const&, std::_Manager_operation) (functional:1610)
==6850==    by 0x11F0D2: ~_Function_base (functional:1690)
==6850==    by 0x11F0D2: ~function (functional:1834)
==6850==    by 0x11F0D2: TcpConnection::~TcpConnection() (TcpConnection.cc:39)
==6850==    by 0x11BF42: destroy<TcpConnection> (new_allocator.h:124)
==6850==    by 0x11BF42: destroy<TcpConnection> (alloc_traits.h:487)
==6850==    by 0x11BF42: std::_Sp_counted_ptr_inplace<TcpConnection, std::allocator<TcpConnection>, (__gnu_cxx::_Lock_policy)2>::_M_dispose() (shared_ptr_base.h:529)
==6850==    by 0x1113F3: _M_release (shared_ptr_base.h:150)
==6850==    by 0x1113F3: ~__shared_count (shared_ptr_base.h:662)
==6850==    by 0x1113F3: ~__shared_ptr (shared_ptr_base.h:928)
==6850==    by 0x1113F3: ~shared_ptr (shared_ptr.h:93)
==6850==    by 0x1113F3: HttpSession::addToBuf() (HttpSession.cc:538)
==6850==    by 0x1155C8: HttpSession::handleMessageTask(std::shared_ptr<HttpProcessContext>) (HttpSession.cc:348)
==6850==    by 0x1161B3: HttpSession::handleMessage(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (HttpSession.cc:189)
==6850==    by 0x10E764: __invoke_impl<void, void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:227)
==6850==    by 0x10E764: __invoke<void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:251)
==6850==    by 0x10E764: operator()<std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:604)
==6850==    by 0x10E764: __call<void, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, 0ul, 1ul> (functional:934)
==6850==    by 0x10E764: operator()<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:993)
==6850==    by 0x10E764: std::_Function_handler<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_invoke(std::_Any_data const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (functional:1731)
==6850==    by 0x121C45: std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)>::operator()(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) const (functional:2127)
==6850==    by 0x120104: TcpConnection::handleRead() (TcpConnection.cc:132)
==6850==    by 0x1216CC: __invoke_impl<void, void (TcpConnection::* const&)(), TcpConnection*&> (functional:227)
==6850==    by 0x1216CC: __invoke<void (TcpConnection::* const&)(), TcpConnection*&> (functional:251)
==6850==    by 0x1216CC: operator()<TcpConnection*&> (functional:604)
==6850==    by 0x1216CC: __call<void, 0ul> (functional:934)
==6850==    by 0x1216CC: operator()<> (functional:993)
==6850==    by 0x1216CC: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpConnection::*)()> (TcpConnection*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==  Block was alloc'd at
==6850==    at 0x4C2E48C: operator new(unsigned long) (vg_replace_malloc.c:334)
==6850==    by 0x10DA8F: allocate (new_allocator.h:104)
==6850==    by 0x10DA8F: allocate (alloc_traits.h:436)
==6850==    by 0x10DA8F: __allocate_guarded<std::allocator<std::_Sp_counted_ptr_inplace<HttpSession, std::allocator<HttpSession>, (__gnu_cxx::_Lock_policy)2u> > > (allocated_ptr.h:103)
==6850==    by 0x10DA8F: __shared_count<HttpSession, std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr_base.h:613)
==6850==    by 0x10DA8F: __shared_ptr<std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr_base.h:1100)
==6850==    by 0x10DA8F: shared_ptr<std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:319)
==6850==    by 0x10DA8F: allocate_shared<HttpSession, std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:620)
==6850==    by 0x10DA8F: make_shared<HttpSession, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:636)
==6850==    by 0x10DA8F: HttpServer::handleNewConnection(std::shared_ptr<TcpConnection>, EventLoop*) (HttpServer.cc:34)
==6850==    by 0x10EE32: __invoke_impl<void, void (HttpServer::* const&)(std::shared_ptr<TcpConnection>, EventLoop*), HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:227)
==6850==    by 0x10EE32: __invoke<void (HttpServer::* const&)(std::shared_ptr<TcpConnection>, EventLoop*), HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:251)
==6850==    by 0x10EE32: operator()<HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:604)
==6850==    by 0x10EE32: __call<void, std::shared_ptr<TcpConnection>&&, EventLoop*&&, 0ul, 1ul, 2ul> (functional:934)
==6850==    by 0x10EE32: operator()<std::shared_ptr<TcpConnection>, EventLoop*> (functional:993)
==6850==    by 0x10EE32: std::_Function_handler<void (std::shared_ptr<TcpConnection>, EventLoop*), std::_Bind<std::_Mem_fn<void (HttpServer::*)(std::shared_ptr<TcpConnection>, EventLoop*)> (HttpServer*, std::_Placeholder<1>, std::_Placeholder<2>)> >::_M_invoke(std::_Any_data const&, std::shared_ptr<TcpConnection>&&, EventLoop*&&) (functional:1731)
==6850==    by 0x11B365: operator() (functional:2127)
==6850==    by 0x11B365: TcpServer::onNewConnection() (TcpServer.cc:94)
==6850==    by 0x11B9D0: __invoke_impl<void, void (TcpServer::* const&)(), TcpServer*&> (functional:227)
==6850==    by 0x11B9D0: __invoke<void (TcpServer::* const&)(), TcpServer*&> (functional:251)
==6850==    by 0x11B9D0: operator()<TcpServer*&> (functional:604)
==6850==    by 0x11B9D0: __call<void, 0ul> (functional:934)
==6850==    by 0x11B9D0: operator()<> (functional:993)
==6850==    by 0x11B9D0: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpServer::*)()> (TcpServer*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==    by 0x10D04F: std::function<void ()>::operator()() const (functional:2127)
==6850==    by 0x10CF9D: Channel::handleEvent() (Channel.cc:28)
==6850==    by 0x11890C: EventLoop::loop() (EventLoop.cc:121)
==6850==    by 0x10F645: main (main.cc:48)
==6850== 
==6850== Invalid write of size 8
==6850==    at 0x116246: HttpSession::handleMessage(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (HttpSession.cc:191)
==6850==    by 0x10E764: __invoke_impl<void, void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:227)
==6850==    by 0x10E764: __invoke<void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:251)
==6850==    by 0x10E764: operator()<std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:604)
==6850==    by 0x10E764: __call<void, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, 0ul, 1ul> (functional:934)
==6850==    by 0x10E764: operator()<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:993)
==6850==    by 0x10E764: std::_Function_handler<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_invoke(std::_Any_data const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (functional:1731)
==6850==    by 0x121C45: std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)>::operator()(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) const (functional:2127)
==6850==    by 0x120104: TcpConnection::handleRead() (TcpConnection.cc:132)
==6850==    by 0x1216CC: __invoke_impl<void, void (TcpConnection::* const&)(), TcpConnection*&> (functional:227)
==6850==    by 0x1216CC: __invoke<void (TcpConnection::* const&)(), TcpConnection*&> (functional:251)
==6850==    by 0x1216CC: operator()<TcpConnection*&> (functional:604)
==6850==    by 0x1216CC: __call<void, 0ul> (functional:934)
==6850==    by 0x1216CC: operator()<> (functional:993)
==6850==    by 0x1216CC: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpConnection::*)()> (TcpConnection*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==    by 0x10D04F: std::function<void ()>::operator()() const (functional:2127)
==6850==    by 0x10CF9D: Channel::handleEvent() (Channel.cc:28)
==6850==    by 0x11890C: EventLoop::loop() (EventLoop.cc:121)
==6850==    by 0x10F645: main (main.cc:48)
==6850==  Address 0x5d3d2d0 is 192 bytes inside a block of size 232 free'd
==6850==    at 0x4C2F4AA: operator delete(void*) (vg_replace_malloc.c:576)
==6850==    by 0x10E98E: deallocate (new_allocator.h:110)
==6850==    by 0x10E98E: deallocate (alloc_traits.h:462)
==6850==    by 0x10E98E: ~__allocated_ptr (allocated_ptr.h:73)
==6850==    by 0x10E98E: std::_Sp_counted_ptr_inplace<HttpSession, std::allocator<HttpSession>, (__gnu_cxx::_Lock_policy)2>::_M_destroy() (shared_ptr_base.h:537)
==6850==    by 0x10EAD7: _M_release (shared_ptr_base.h:166)
==6850==    by 0x10EAD7: ~__shared_count (shared_ptr_base.h:662)
==6850==    by 0x10EAD7: ~__shared_ptr (shared_ptr_base.h:928)
==6850==    by 0x10EAD7: ~shared_ptr (shared_ptr.h:93)
==6850==    by 0x10EAD7: ~_Head_base (tuple:102)
==6850==    by 0x10EAD7: ~_Tuple_impl (tuple:180)
==6850==    by 0x10EAD7: ~tuple (tuple:866)
==6850==    by 0x10EAD7: ~_Bind (functional:918)
==6850==    by 0x10EAD7: _M_destroy (functional:1586)
==6850==    by 0x10EAD7: std::_Function_base::_Base_manager<std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_manager(std::_Any_data&, std::_Any_data const&, std::_Manager_operation) (functional:1610)
==6850==    by 0x11F0D2: ~_Function_base (functional:1690)
==6850==    by 0x11F0D2: ~function (functional:1834)
==6850==    by 0x11F0D2: TcpConnection::~TcpConnection() (TcpConnection.cc:39)
==6850==    by 0x11BF42: destroy<TcpConnection> (new_allocator.h:124)
==6850==    by 0x11BF42: destroy<TcpConnection> (alloc_traits.h:487)
==6850==    by 0x11BF42: std::_Sp_counted_ptr_inplace<TcpConnection, std::allocator<TcpConnection>, (__gnu_cxx::_Lock_policy)2>::_M_dispose() (shared_ptr_base.h:529)
==6850==    by 0x1113F3: _M_release (shared_ptr_base.h:150)
==6850==    by 0x1113F3: ~__shared_count (shared_ptr_base.h:662)
==6850==    by 0x1113F3: ~__shared_ptr (shared_ptr_base.h:928)
==6850==    by 0x1113F3: ~shared_ptr (shared_ptr.h:93)
==6850==    by 0x1113F3: HttpSession::addToBuf() (HttpSession.cc:538)
==6850==    by 0x1155C8: HttpSession::handleMessageTask(std::shared_ptr<HttpProcessContext>) (HttpSession.cc:348)
==6850==    by 0x1161B3: HttpSession::handleMessage(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (HttpSession.cc:189)
==6850==    by 0x10E764: __invoke_impl<void, void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:227)
==6850==    by 0x10E764: __invoke<void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:251)
==6850==    by 0x10E764: operator()<std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:604)
==6850==    by 0x10E764: __call<void, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, 0ul, 1ul> (functional:934)
==6850==    by 0x10E764: operator()<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:993)
==6850==    by 0x10E764: std::_Function_handler<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_invoke(std::_Any_data const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (functional:1731)
==6850==    by 0x121C45: std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)>::operator()(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) const (functional:2127)
==6850==    by 0x120104: TcpConnection::handleRead() (TcpConnection.cc:132)
==6850==    by 0x1216CC: __invoke_impl<void, void (TcpConnection::* const&)(), TcpConnection*&> (functional:227)
==6850==    by 0x1216CC: __invoke<void (TcpConnection::* const&)(), TcpConnection*&> (functional:251)
==6850==    by 0x1216CC: operator()<TcpConnection*&> (functional:604)
==6850==    by 0x1216CC: __call<void, 0ul> (functional:934)
==6850==    by 0x1216CC: operator()<> (functional:993)
==6850==    by 0x1216CC: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpConnection::*)()> (TcpConnection*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==  Block was alloc'd at
==6850==    at 0x4C2E48C: operator new(unsigned long) (vg_replace_malloc.c:334)
==6850==    by 0x10DA8F: allocate (new_allocator.h:104)
==6850==    by 0x10DA8F: allocate (alloc_traits.h:436)
==6850==    by 0x10DA8F: __allocate_guarded<std::allocator<std::_Sp_counted_ptr_inplace<HttpSession, std::allocator<HttpSession>, (__gnu_cxx::_Lock_policy)2u> > > (allocated_ptr.h:103)
==6850==    by 0x10DA8F: __shared_count<HttpSession, std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr_base.h:613)
==6850==    by 0x10DA8F: __shared_ptr<std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr_base.h:1100)
==6850==    by 0x10DA8F: shared_ptr<std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:319)
==6850==    by 0x10DA8F: allocate_shared<HttpSession, std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:620)
==6850==    by 0x10DA8F: make_shared<HttpSession, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:636)
==6850==    by 0x10DA8F: HttpServer::handleNewConnection(std::shared_ptr<TcpConnection>, EventLoop*) (HttpServer.cc:34)
==6850==    by 0x10EE32: __invoke_impl<void, void (HttpServer::* const&)(std::shared_ptr<TcpConnection>, EventLoop*), HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:227)
==6850==    by 0x10EE32: __invoke<void (HttpServer::* const&)(std::shared_ptr<TcpConnection>, EventLoop*), HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:251)
==6850==    by 0x10EE32: operator()<HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:604)
==6850==    by 0x10EE32: __call<void, std::shared_ptr<TcpConnection>&&, EventLoop*&&, 0ul, 1ul, 2ul> (functional:934)
==6850==    by 0x10EE32: operator()<std::shared_ptr<TcpConnection>, EventLoop*> (functional:993)
==6850==    by 0x10EE32: std::_Function_handler<void (std::shared_ptr<TcpConnection>, EventLoop*), std::_Bind<std::_Mem_fn<void (HttpServer::*)(std::shared_ptr<TcpConnection>, EventLoop*)> (HttpServer*, std::_Placeholder<1>, std::_Placeholder<2>)> >::_M_invoke(std::_Any_data const&, std::shared_ptr<TcpConnection>&&, EventLoop*&&) (functional:1731)
==6850==    by 0x11B365: operator() (functional:2127)
==6850==    by 0x11B365: TcpServer::onNewConnection() (TcpServer.cc:94)
==6850==    by 0x11B9D0: __invoke_impl<void, void (TcpServer::* const&)(), TcpServer*&> (functional:227)
==6850==    by 0x11B9D0: __invoke<void (TcpServer::* const&)(), TcpServer*&> (functional:251)
==6850==    by 0x11B9D0: operator()<TcpServer*&> (functional:604)
==6850==    by 0x11B9D0: __call<void, 0ul> (functional:934)
==6850==    by 0x11B9D0: operator()<> (functional:993)
==6850==    by 0x11B9D0: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpServer::*)()> (TcpServer*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==    by 0x10D04F: std::function<void ()>::operator()() const (functional:2127)
==6850==    by 0x10CF9D: Channel::handleEvent() (Channel.cc:28)
==6850==    by 0x11890C: EventLoop::loop() (EventLoop.cc:121)
==6850==    by 0x10F645: main (main.cc:48)
==6850== 
==6850== Invalid write of size 8
==6850==    at 0x11624D: swap<HttpProcessContext*> (move.h:192)
==6850==    by 0x11624D: swap (shared_ptr_base.h:1079)
==6850==    by 0x11624D: reset (shared_ptr_base.h:1025)
==6850==    by 0x11624D: HttpSession::handleMessage(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (HttpSession.cc:193)
==6850==    by 0x10E764: __invoke_impl<void, void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:227)
==6850==    by 0x10E764: __invoke<void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:251)
==6850==    by 0x10E764: operator()<std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:604)
==6850==    by 0x10E764: __call<void, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, 0ul, 1ul> (functional:934)
==6850==    by 0x10E764: operator()<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:993)
==6850==    by 0x10E764: std::_Function_handler<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_invoke(std::_Any_data const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (functional:1731)
==6850==    by 0x121C45: std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)>::operator()(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) const (functional:2127)
==6850==    by 0x120104: TcpConnection::handleRead() (TcpConnection.cc:132)
==6850==    by 0x1216CC: __invoke_impl<void, void (TcpConnection::* const&)(), TcpConnection*&> (functional:227)
==6850==    by 0x1216CC: __invoke<void (TcpConnection::* const&)(), TcpConnection*&> (functional:251)
==6850==    by 0x1216CC: operator()<TcpConnection*&> (functional:604)
==6850==    by 0x1216CC: __call<void, 0ul> (functional:934)
==6850==    by 0x1216CC: operator()<> (functional:993)
==6850==    by 0x1216CC: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpConnection::*)()> (TcpConnection*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==    by 0x10D04F: std::function<void ()>::operator()() const (functional:2127)
==6850==    by 0x10CF9D: Channel::handleEvent() (Channel.cc:28)
==6850==    by 0x11890C: EventLoop::loop() (EventLoop.cc:121)
==6850==    by 0x10F645: main (main.cc:48)
==6850==  Address 0x5d3d290 is 128 bytes inside a block of size 232 free'd
==6850==    at 0x4C2F4AA: operator delete(void*) (vg_replace_malloc.c:576)
==6850==    by 0x10E98E: deallocate (new_allocator.h:110)
==6850==    by 0x10E98E: deallocate (alloc_traits.h:462)
==6850==    by 0x10E98E: ~__allocated_ptr (allocated_ptr.h:73)
==6850==    by 0x10E98E: std::_Sp_counted_ptr_inplace<HttpSession, std::allocator<HttpSession>, (__gnu_cxx::_Lock_policy)2>::_M_destroy() (shared_ptr_base.h:537)
==6850==    by 0x10EAD7: _M_release (shared_ptr_base.h:166)
==6850==    by 0x10EAD7: ~__shared_count (shared_ptr_base.h:662)
==6850==    by 0x10EAD7: ~__shared_ptr (shared_ptr_base.h:928)
==6850==    by 0x10EAD7: ~shared_ptr (shared_ptr.h:93)
==6850==    by 0x10EAD7: ~_Head_base (tuple:102)
==6850==    by 0x10EAD7: ~_Tuple_impl (tuple:180)
==6850==    by 0x10EAD7: ~tuple (tuple:866)
==6850==    by 0x10EAD7: ~_Bind (functional:918)
==6850==    by 0x10EAD7: _M_destroy (functional:1586)
==6850==    by 0x10EAD7: std::_Function_base::_Base_manager<std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_manager(std::_Any_data&, std::_Any_data const&, std::_Manager_operation) (functional:1610)
==6850==    by 0x11F0D2: ~_Function_base (functional:1690)
==6850==    by 0x11F0D2: ~function (functional:1834)
==6850==    by 0x11F0D2: TcpConnection::~TcpConnection() (TcpConnection.cc:39)
==6850==    by 0x11BF42: destroy<TcpConnection> (new_allocator.h:124)
==6850==    by 0x11BF42: destroy<TcpConnection> (alloc_traits.h:487)
==6850==    by 0x11BF42: std::_Sp_counted_ptr_inplace<TcpConnection, std::allocator<TcpConnection>, (__gnu_cxx::_Lock_policy)2>::_M_dispose() (shared_ptr_base.h:529)
==6850==    by 0x1113F3: _M_release (shared_ptr_base.h:150)
==6850==    by 0x1113F3: ~__shared_count (shared_ptr_base.h:662)
==6850==    by 0x1113F3: ~__shared_ptr (shared_ptr_base.h:928)
==6850==    by 0x1113F3: ~shared_ptr (shared_ptr.h:93)
==6850==    by 0x1113F3: HttpSession::addToBuf() (HttpSession.cc:538)
==6850==    by 0x1155C8: HttpSession::handleMessageTask(std::shared_ptr<HttpProcessContext>) (HttpSession.cc:348)
==6850==    by 0x1161B3: HttpSession::handleMessage(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (HttpSession.cc:189)
==6850==    by 0x10E764: __invoke_impl<void, void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:227)
==6850==    by 0x10E764: __invoke<void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:251)
==6850==    by 0x10E764: operator()<std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:604)
==6850==    by 0x10E764: __call<void, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, 0ul, 1ul> (functional:934)
==6850==    by 0x10E764: operator()<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:993)
==6850==    by 0x10E764: std::_Function_handler<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_invoke(std::_Any_data const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (functional:1731)
==6850==    by 0x121C45: std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)>::operator()(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) const (functional:2127)
==6850==    by 0x120104: TcpConnection::handleRead() (TcpConnection.cc:132)
==6850==    by 0x1216CC: __invoke_impl<void, void (TcpConnection::* const&)(), TcpConnection*&> (functional:227)
==6850==    by 0x1216CC: __invoke<void (TcpConnection::* const&)(), TcpConnection*&> (functional:251)
==6850==    by 0x1216CC: operator()<TcpConnection*&> (functional:604)
==6850==    by 0x1216CC: __call<void, 0ul> (functional:934)
==6850==    by 0x1216CC: operator()<> (functional:993)
==6850==    by 0x1216CC: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpConnection::*)()> (TcpConnection*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==  Block was alloc'd at
==6850==    at 0x4C2E48C: operator new(unsigned long) (vg_replace_malloc.c:334)
==6850==    by 0x10DA8F: allocate (new_allocator.h:104)
==6850==    by 0x10DA8F: allocate (alloc_traits.h:436)
==6850==    by 0x10DA8F: __allocate_guarded<std::allocator<std::_Sp_counted_ptr_inplace<HttpSession, std::allocator<HttpSession>, (__gnu_cxx::_Lock_policy)2u> > > (allocated_ptr.h:103)
==6850==    by 0x10DA8F: __shared_count<HttpSession, std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr_base.h:613)
==6850==    by 0x10DA8F: __shared_ptr<std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr_base.h:1100)
==6850==    by 0x10DA8F: shared_ptr<std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:319)
==6850==    by 0x10DA8F: allocate_shared<HttpSession, std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:620)
==6850==    by 0x10DA8F: make_shared<HttpSession, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:636)
==6850==    by 0x10DA8F: HttpServer::handleNewConnection(std::shared_ptr<TcpConnection>, EventLoop*) (HttpServer.cc:34)
==6850==    by 0x10EE32: __invoke_impl<void, void (HttpServer::* const&)(std::shared_ptr<TcpConnection>, EventLoop*), HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:227)
==6850==    by 0x10EE32: __invoke<void (HttpServer::* const&)(std::shared_ptr<TcpConnection>, EventLoop*), HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:251)
==6850==    by 0x10EE32: operator()<HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:604)
==6850==    by 0x10EE32: __call<void, std::shared_ptr<TcpConnection>&&, EventLoop*&&, 0ul, 1ul, 2ul> (functional:934)
==6850==    by 0x10EE32: operator()<std::shared_ptr<TcpConnection>, EventLoop*> (functional:993)
==6850==    by 0x10EE32: std::_Function_handler<void (std::shared_ptr<TcpConnection>, EventLoop*), std::_Bind<std::_Mem_fn<void (HttpServer::*)(std::shared_ptr<TcpConnection>, EventLoop*)> (HttpServer*, std::_Placeholder<1>, std::_Placeholder<2>)> >::_M_invoke(std::_Any_data const&, std::shared_ptr<TcpConnection>&&, EventLoop*&&) (functional:1731)
==6850==    by 0x11B365: operator() (functional:2127)
==6850==    by 0x11B365: TcpServer::onNewConnection() (TcpServer.cc:94)
==6850==    by 0x11B9D0: __invoke_impl<void, void (TcpServer::* const&)(), TcpServer*&> (functional:227)
==6850==    by 0x11B9D0: __invoke<void (TcpServer::* const&)(), TcpServer*&> (functional:251)
==6850==    by 0x11B9D0: operator()<TcpServer*&> (functional:604)
==6850==    by 0x11B9D0: __call<void, 0ul> (functional:934)
==6850==    by 0x11B9D0: operator()<> (functional:993)
==6850==    by 0x11B9D0: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpServer::*)()> (TcpServer*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==    by 0x10D04F: std::function<void ()>::operator()() const (functional:2127)
==6850==    by 0x10CF9D: Channel::handleEvent() (Channel.cc:28)
==6850==    by 0x11890C: EventLoop::loop() (EventLoop.cc:121)
==6850==    by 0x10F645: main (main.cc:48)
==6850== 
==6850== Invalid read of size 8
==6850==    at 0x116255: _M_swap (shared_ptr_base.h:690)
==6850==    by 0x116255: swap (shared_ptr_base.h:1080)
==6850==    by 0x116255: reset (shared_ptr_base.h:1025)
==6850==    by 0x116255: HttpSession::handleMessage(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (HttpSession.cc:193)
==6850==    by 0x10E764: __invoke_impl<void, void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:227)
==6850==    by 0x10E764: __invoke<void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:251)
==6850==    by 0x10E764: operator()<std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:604)
==6850==    by 0x10E764: __call<void, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, 0ul, 1ul> (functional:934)
==6850==    by 0x10E764: operator()<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:993)
==6850==    by 0x10E764: std::_Function_handler<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_invoke(std::_Any_data const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (functional:1731)
==6850==    by 0x121C45: std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)>::operator()(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) const (functional:2127)
==6850==    by 0x120104: TcpConnection::handleRead() (TcpConnection.cc:132)
==6850==    by 0x1216CC: __invoke_impl<void, void (TcpConnection::* const&)(), TcpConnection*&> (functional:227)
==6850==    by 0x1216CC: __invoke<void (TcpConnection::* const&)(), TcpConnection*&> (functional:251)
==6850==    by 0x1216CC: operator()<TcpConnection*&> (functional:604)
==6850==    by 0x1216CC: __call<void, 0ul> (functional:934)
==6850==    by 0x1216CC: operator()<> (functional:993)
==6850==    by 0x1216CC: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpConnection::*)()> (TcpConnection*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==    by 0x10D04F: std::function<void ()>::operator()() const (functional:2127)
==6850==    by 0x10CF9D: Channel::handleEvent() (Channel.cc:28)
==6850==    by 0x11890C: EventLoop::loop() (EventLoop.cc:121)
==6850==    by 0x10F645: main (main.cc:48)
==6850==  Address 0x5d3d298 is 136 bytes inside a block of size 232 free'd
==6850==    at 0x4C2F4AA: operator delete(void*) (vg_replace_malloc.c:576)
==6850==    by 0x10E98E: deallocate (new_allocator.h:110)
==6850==    by 0x10E98E: deallocate (alloc_traits.h:462)
==6850==    by 0x10E98E: ~__allocated_ptr (allocated_ptr.h:73)
==6850==    by 0x10E98E: std::_Sp_counted_ptr_inplace<HttpSession, std::allocator<HttpSession>, (__gnu_cxx::_Lock_policy)2>::_M_destroy() (shared_ptr_base.h:537)
==6850==    by 0x10EAD7: _M_release (shared_ptr_base.h:166)
==6850==    by 0x10EAD7: ~__shared_count (shared_ptr_base.h:662)
==6850==    by 0x10EAD7: ~__shared_ptr (shared_ptr_base.h:928)
==6850==    by 0x10EAD7: ~shared_ptr (shared_ptr.h:93)
==6850==    by 0x10EAD7: ~_Head_base (tuple:102)
==6850==    by 0x10EAD7: ~_Tuple_impl (tuple:180)
==6850==    by 0x10EAD7: ~tuple (tuple:866)
==6850==    by 0x10EAD7: ~_Bind (functional:918)
==6850==    by 0x10EAD7: _M_destroy (functional:1586)
==6850==    by 0x10EAD7: std::_Function_base::_Base_manager<std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_manager(std::_Any_data&, std::_Any_data const&, std::_Manager_operation) (functional:1610)
==6850==    by 0x11F0D2: ~_Function_base (functional:1690)
==6850==    by 0x11F0D2: ~function (functional:1834)
==6850==    by 0x11F0D2: TcpConnection::~TcpConnection() (TcpConnection.cc:39)
==6850==    by 0x11BF42: destroy<TcpConnection> (new_allocator.h:124)
==6850==    by 0x11BF42: destroy<TcpConnection> (alloc_traits.h:487)
==6850==    by 0x11BF42: std::_Sp_counted_ptr_inplace<TcpConnection, std::allocator<TcpConnection>, (__gnu_cxx::_Lock_policy)2>::_M_dispose() (shared_ptr_base.h:529)
==6850==    by 0x1113F3: _M_release (shared_ptr_base.h:150)
==6850==    by 0x1113F3: ~__shared_count (shared_ptr_base.h:662)
==6850==    by 0x1113F3: ~__shared_ptr (shared_ptr_base.h:928)
==6850==    by 0x1113F3: ~shared_ptr (shared_ptr.h:93)
==6850==    by 0x1113F3: HttpSession::addToBuf() (HttpSession.cc:538)
==6850==    by 0x1155C8: HttpSession::handleMessageTask(std::shared_ptr<HttpProcessContext>) (HttpSession.cc:348)
==6850==    by 0x1161B3: HttpSession::handleMessage(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (HttpSession.cc:189)
==6850==    by 0x10E764: __invoke_impl<void, void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:227)
==6850==    by 0x10E764: __invoke<void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:251)
==6850==    by 0x10E764: operator()<std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:604)
==6850==    by 0x10E764: __call<void, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, 0ul, 1ul> (functional:934)
==6850==    by 0x10E764: operator()<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:993)
==6850==    by 0x10E764: std::_Function_handler<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_invoke(std::_Any_data const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (functional:1731)
==6850==    by 0x121C45: std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)>::operator()(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) const (functional:2127)
==6850==    by 0x120104: TcpConnection::handleRead() (TcpConnection.cc:132)
==6850==    by 0x1216CC: __invoke_impl<void, void (TcpConnection::* const&)(), TcpConnection*&> (functional:227)
==6850==    by 0x1216CC: __invoke<void (TcpConnection::* const&)(), TcpConnection*&> (functional:251)
==6850==    by 0x1216CC: operator()<TcpConnection*&> (functional:604)
==6850==    by 0x1216CC: __call<void, 0ul> (functional:934)
==6850==    by 0x1216CC: operator()<> (functional:993)
==6850==    by 0x1216CC: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpConnection::*)()> (TcpConnection*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==  Block was alloc'd at
==6850==    at 0x4C2E48C: operator new(unsigned long) (vg_replace_malloc.c:334)
==6850==    by 0x10DA8F: allocate (new_allocator.h:104)
==6850==    by 0x10DA8F: allocate (alloc_traits.h:436)
==6850==    by 0x10DA8F: __allocate_guarded<std::allocator<std::_Sp_counted_ptr_inplace<HttpSession, std::allocator<HttpSession>, (__gnu_cxx::_Lock_policy)2u> > > (allocated_ptr.h:103)
==6850==    by 0x10DA8F: __shared_count<HttpSession, std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr_base.h:613)
==6850==    by 0x10DA8F: __shared_ptr<std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr_base.h:1100)
==6850==    by 0x10DA8F: shared_ptr<std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:319)
==6850==    by 0x10DA8F: allocate_shared<HttpSession, std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:620)
==6850==    by 0x10DA8F: make_shared<HttpSession, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:636)
==6850==    by 0x10DA8F: HttpServer::handleNewConnection(std::shared_ptr<TcpConnection>, EventLoop*) (HttpServer.cc:34)
==6850==    by 0x10EE32: __invoke_impl<void, void (HttpServer::* const&)(std::shared_ptr<TcpConnection>, EventLoop*), HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:227)
==6850==    by 0x10EE32: __invoke<void (HttpServer::* const&)(std::shared_ptr<TcpConnection>, EventLoop*), HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:251)
==6850==    by 0x10EE32: operator()<HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:604)
==6850==    by 0x10EE32: __call<void, std::shared_ptr<TcpConnection>&&, EventLoop*&&, 0ul, 1ul, 2ul> (functional:934)
==6850==    by 0x10EE32: operator()<std::shared_ptr<TcpConnection>, EventLoop*> (functional:993)
==6850==    by 0x10EE32: std::_Function_handler<void (std::shared_ptr<TcpConnection>, EventLoop*), std::_Bind<std::_Mem_fn<void (HttpServer::*)(std::shared_ptr<TcpConnection>, EventLoop*)> (HttpServer*, std::_Placeholder<1>, std::_Placeholder<2>)> >::_M_invoke(std::_Any_data const&, std::shared_ptr<TcpConnection>&&, EventLoop*&&) (functional:1731)
==6850==    by 0x11B365: operator() (functional:2127)
==6850==    by 0x11B365: TcpServer::onNewConnection() (TcpServer.cc:94)
==6850==    by 0x11B9D0: __invoke_impl<void, void (TcpServer::* const&)(), TcpServer*&> (functional:227)
==6850==    by 0x11B9D0: __invoke<void (TcpServer::* const&)(), TcpServer*&> (functional:251)
==6850==    by 0x11B9D0: operator()<TcpServer*&> (functional:604)
==6850==    by 0x11B9D0: __call<void, 0ul> (functional:934)
==6850==    by 0x11B9D0: operator()<> (functional:993)
==6850==    by 0x11B9D0: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpServer::*)()> (TcpServer*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==    by 0x10D04F: std::function<void ()>::operator()() const (functional:2127)
==6850==    by 0x10CF9D: Channel::handleEvent() (Channel.cc:28)
==6850==    by 0x11890C: EventLoop::loop() (EventLoop.cc:121)
==6850==    by 0x10F645: main (main.cc:48)
==6850== 
==6850== Invalid write of size 8
==6850==    at 0x116259: _M_swap (shared_ptr_base.h:691)
==6850==    by 0x116259: swap (shared_ptr_base.h:1080)
==6850==    by 0x116259: reset (shared_ptr_base.h:1025)
==6850==    by 0x116259: HttpSession::handleMessage(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (HttpSession.cc:193)
==6850==    by 0x10E764: __invoke_impl<void, void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:227)
==6850==    by 0x10E764: __invoke<void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:251)
==6850==    by 0x10E764: operator()<std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:604)
==6850==    by 0x10E764: __call<void, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, 0ul, 1ul> (functional:934)
==6850==    by 0x10E764: operator()<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:993)
==6850==    by 0x10E764: std::_Function_handler<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_invoke(std::_Any_data const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (functional:1731)
==6850==    by 0x121C45: std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)>::operator()(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) const (functional:2127)
==6850==    by 0x120104: TcpConnection::handleRead() (TcpConnection.cc:132)
==6850==    by 0x1216CC: __invoke_impl<void, void (TcpConnection::* const&)(), TcpConnection*&> (functional:227)
==6850==    by 0x1216CC: __invoke<void (TcpConnection::* const&)(), TcpConnection*&> (functional:251)
==6850==    by 0x1216CC: operator()<TcpConnection*&> (functional:604)
==6850==    by 0x1216CC: __call<void, 0ul> (functional:934)
==6850==    by 0x1216CC: operator()<> (functional:993)
==6850==    by 0x1216CC: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpConnection::*)()> (TcpConnection*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==    by 0x10D04F: std::function<void ()>::operator()() const (functional:2127)
==6850==    by 0x10CF9D: Channel::handleEvent() (Channel.cc:28)
==6850==    by 0x11890C: EventLoop::loop() (EventLoop.cc:121)
==6850==    by 0x10F645: main (main.cc:48)
==6850==  Address 0x5d3d298 is 136 bytes inside a block of size 232 free'd
==6850==    at 0x4C2F4AA: operator delete(void*) (vg_replace_malloc.c:576)
==6850==    by 0x10E98E: deallocate (new_allocator.h:110)
==6850==    by 0x10E98E: deallocate (alloc_traits.h:462)
==6850==    by 0x10E98E: ~__allocated_ptr (allocated_ptr.h:73)
==6850==    by 0x10E98E: std::_Sp_counted_ptr_inplace<HttpSession, std::allocator<HttpSession>, (__gnu_cxx::_Lock_policy)2>::_M_destroy() (shared_ptr_base.h:537)
==6850==    by 0x10EAD7: _M_release (shared_ptr_base.h:166)
==6850==    by 0x10EAD7: ~__shared_count (shared_ptr_base.h:662)
==6850==    by 0x10EAD7: ~__shared_ptr (shared_ptr_base.h:928)
==6850==    by 0x10EAD7: ~shared_ptr (shared_ptr.h:93)
==6850==    by 0x10EAD7: ~_Head_base (tuple:102)
==6850==    by 0x10EAD7: ~_Tuple_impl (tuple:180)
==6850==    by 0x10EAD7: ~tuple (tuple:866)
==6850==    by 0x10EAD7: ~_Bind (functional:918)
==6850==    by 0x10EAD7: _M_destroy (functional:1586)
==6850==    by 0x10EAD7: std::_Function_base::_Base_manager<std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_manager(std::_Any_data&, std::_Any_data const&, std::_Manager_operation) (functional:1610)
==6850==    by 0x11F0D2: ~_Function_base (functional:1690)
==6850==    by 0x11F0D2: ~function (functional:1834)
==6850==    by 0x11F0D2: TcpConnection::~TcpConnection() (TcpConnection.cc:39)
==6850==    by 0x11BF42: destroy<TcpConnection> (new_allocator.h:124)
==6850==    by 0x11BF42: destroy<TcpConnection> (alloc_traits.h:487)
==6850==    by 0x11BF42: std::_Sp_counted_ptr_inplace<TcpConnection, std::allocator<TcpConnection>, (__gnu_cxx::_Lock_policy)2>::_M_dispose() (shared_ptr_base.h:529)
==6850==    by 0x1113F3: _M_release (shared_ptr_base.h:150)
==6850==    by 0x1113F3: ~__shared_count (shared_ptr_base.h:662)
==6850==    by 0x1113F3: ~__shared_ptr (shared_ptr_base.h:928)
==6850==    by 0x1113F3: ~shared_ptr (shared_ptr.h:93)
==6850==    by 0x1113F3: HttpSession::addToBuf() (HttpSession.cc:538)
==6850==    by 0x1155C8: HttpSession::handleMessageTask(std::shared_ptr<HttpProcessContext>) (HttpSession.cc:348)
==6850==    by 0x1161B3: HttpSession::handleMessage(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (HttpSession.cc:189)
==6850==    by 0x10E764: __invoke_impl<void, void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:227)
==6850==    by 0x10E764: __invoke<void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:251)
==6850==    by 0x10E764: operator()<std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:604)
==6850==    by 0x10E764: __call<void, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, 0ul, 1ul> (functional:934)
==6850==    by 0x10E764: operator()<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:993)
==6850==    by 0x10E764: std::_Function_handler<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_invoke(std::_Any_data const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (functional:1731)
==6850==    by 0x121C45: std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)>::operator()(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) const (functional:2127)
==6850==    by 0x120104: TcpConnection::handleRead() (TcpConnection.cc:132)
==6850==    by 0x1216CC: __invoke_impl<void, void (TcpConnection::* const&)(), TcpConnection*&> (functional:227)
==6850==    by 0x1216CC: __invoke<void (TcpConnection::* const&)(), TcpConnection*&> (functional:251)
==6850==    by 0x1216CC: operator()<TcpConnection*&> (functional:604)
==6850==    by 0x1216CC: __call<void, 0ul> (functional:934)
==6850==    by 0x1216CC: operator()<> (functional:993)
==6850==    by 0x1216CC: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpConnection::*)()> (TcpConnection*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==  Block was alloc'd at
==6850==    at 0x4C2E48C: operator new(unsigned long) (vg_replace_malloc.c:334)
==6850==    by 0x10DA8F: allocate (new_allocator.h:104)
==6850==    by 0x10DA8F: allocate (alloc_traits.h:436)
==6850==    by 0x10DA8F: __allocate_guarded<std::allocator<std::_Sp_counted_ptr_inplace<HttpSession, std::allocator<HttpSession>, (__gnu_cxx::_Lock_policy)2u> > > (allocated_ptr.h:103)
==6850==    by 0x10DA8F: __shared_count<HttpSession, std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr_base.h:613)
==6850==    by 0x10DA8F: __shared_ptr<std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr_base.h:1100)
==6850==    by 0x10DA8F: shared_ptr<std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:319)
==6850==    by 0x10DA8F: allocate_shared<HttpSession, std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:620)
==6850==    by 0x10DA8F: make_shared<HttpSession, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:636)
==6850==    by 0x10DA8F: HttpServer::handleNewConnection(std::shared_ptr<TcpConnection>, EventLoop*) (HttpServer.cc:34)
==6850==    by 0x10EE32: __invoke_impl<void, void (HttpServer::* const&)(std::shared_ptr<TcpConnection>, EventLoop*), HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:227)
==6850==    by 0x10EE32: __invoke<void (HttpServer::* const&)(std::shared_ptr<TcpConnection>, EventLoop*), HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:251)
==6850==    by 0x10EE32: operator()<HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:604)
==6850==    by 0x10EE32: __call<void, std::shared_ptr<TcpConnection>&&, EventLoop*&&, 0ul, 1ul, 2ul> (functional:934)
==6850==    by 0x10EE32: operator()<std::shared_ptr<TcpConnection>, EventLoop*> (functional:993)
==6850==    by 0x10EE32: std::_Function_handler<void (std::shared_ptr<TcpConnection>, EventLoop*), std::_Bind<std::_Mem_fn<void (HttpServer::*)(std::shared_ptr<TcpConnection>, EventLoop*)> (HttpServer*, std::_Placeholder<1>, std::_Placeholder<2>)> >::_M_invoke(std::_Any_data const&, std::shared_ptr<TcpConnection>&&, EventLoop*&&) (functional:1731)
==6850==    by 0x11B365: operator() (functional:2127)
==6850==    by 0x11B365: TcpServer::onNewConnection() (TcpServer.cc:94)
==6850==    by 0x11B9D0: __invoke_impl<void, void (TcpServer::* const&)(), TcpServer*&> (functional:227)
==6850==    by 0x11B9D0: __invoke<void (TcpServer::* const&)(), TcpServer*&> (functional:251)
==6850==    by 0x11B9D0: operator()<TcpServer*&> (functional:604)
==6850==    by 0x11B9D0: __call<void, 0ul> (functional:934)
==6850==    by 0x11B9D0: operator()<> (functional:993)
==6850==    by 0x11B9D0: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpServer::*)()> (TcpServer*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==    by 0x10D04F: std::function<void ()>::operator()() const (functional:2127)
==6850==    by 0x10CF9D: Channel::handleEvent() (Channel.cc:28)
==6850==    by 0x11890C: EventLoop::loop() (EventLoop.cc:121)
==6850==    by 0x10F645: main (main.cc:48)
==6850== 
==6850== Invalid read of size 4
==6850==    at 0x11627A: __exchange_and_add (atomicity.h:49)
==6850==    by 0x11627A: __exchange_and_add_dispatch (atomicity.h:82)
==6850==    by 0x11627A: _M_release (shared_ptr_base.h:147)
==6850==    by 0x11627A: ~__shared_count (shared_ptr_base.h:662)
==6850==    by 0x11627A: ~__shared_ptr (shared_ptr_base.h:928)
==6850==    by 0x11627A: reset (shared_ptr_base.h:1025)
==6850==    by 0x11627A: HttpSession::handleMessage(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (HttpSession.cc:193)
==6850==    by 0x10E764: __invoke_impl<void, void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:227)
==6850==    by 0x10E764: __invoke<void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:251)
==6850==    by 0x10E764: operator()<std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:604)
==6850==    by 0x10E764: __call<void, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, 0ul, 1ul> (functional:934)
==6850==    by 0x10E764: operator()<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:993)
==6850==    by 0x10E764: std::_Function_handler<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_invoke(std::_Any_data const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (functional:1731)
==6850==    by 0x121C45: std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)>::operator()(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) const (functional:2127)
==6850==    by 0x120104: TcpConnection::handleRead() (TcpConnection.cc:132)
==6850==    by 0x1216CC: __invoke_impl<void, void (TcpConnection::* const&)(), TcpConnection*&> (functional:227)
==6850==    by 0x1216CC: __invoke<void (TcpConnection::* const&)(), TcpConnection*&> (functional:251)
==6850==    by 0x1216CC: operator()<TcpConnection*&> (functional:604)
==6850==    by 0x1216CC: __call<void, 0ul> (functional:934)
==6850==    by 0x1216CC: operator()<> (functional:993)
==6850==    by 0x1216CC: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpConnection::*)()> (TcpConnection*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==    by 0x10D04F: std::function<void ()>::operator()() const (functional:2127)
==6850==    by 0x10CF9D: Channel::handleEvent() (Channel.cc:28)
==6850==    by 0x11890C: EventLoop::loop() (EventLoop.cc:121)
==6850==    by 0x10F645: main (main.cc:48)
==6850==  Address 0x610e088 is 8 bytes inside a block of size 280 free'd
==6850==    at 0x4C2F4AA: operator delete(void*) (vg_replace_malloc.c:576)
==6850==    by 0x116576: deallocate (new_allocator.h:110)
==6850==    by 0x116576: deallocate (alloc_traits.h:462)
==6850==    by 0x116576: ~__allocated_ptr (allocated_ptr.h:73)
==6850==    by 0x116576: std::_Sp_counted_ptr_inplace<HttpProcessContext, std::allocator<HttpProcessContext>, (__gnu_cxx::_Lock_policy)2>::_M_destroy() (shared_ptr_base.h:537)
==6850==    by 0x116211: _M_release (shared_ptr_base.h:166)
==6850==    by 0x116211: ~__shared_count (shared_ptr_base.h:662)
==6850==    by 0x116211: ~__shared_ptr (shared_ptr_base.h:928)
==6850==    by 0x116211: ~shared_ptr (shared_ptr.h:93)
==6850==    by 0x116211: HttpSession::handleMessage(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (HttpSession.cc:189)
==6850==    by 0x10E764: __invoke_impl<void, void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:227)
==6850==    by 0x10E764: __invoke<void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:251)
==6850==    by 0x10E764: operator()<std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:604)
==6850==    by 0x10E764: __call<void, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, 0ul, 1ul> (functional:934)
==6850==    by 0x10E764: operator()<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:993)
==6850==    by 0x10E764: std::_Function_handler<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_invoke(std::_Any_data const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (functional:1731)
==6850==    by 0x121C45: std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)>::operator()(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) const (functional:2127)
==6850==    by 0x120104: TcpConnection::handleRead() (TcpConnection.cc:132)
==6850==    by 0x1216CC: __invoke_impl<void, void (TcpConnection::* const&)(), TcpConnection*&> (functional:227)
==6850==    by 0x1216CC: __invoke<void (TcpConnection::* const&)(), TcpConnection*&> (functional:251)
==6850==    by 0x1216CC: operator()<TcpConnection*&> (functional:604)
==6850==    by 0x1216CC: __call<void, 0ul> (functional:934)
==6850==    by 0x1216CC: operator()<> (functional:993)
==6850==    by 0x1216CC: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpConnection::*)()> (TcpConnection*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==    by 0x10D04F: std::function<void ()>::operator()() const (functional:2127)
==6850==    by 0x10CF9D: Channel::handleEvent() (Channel.cc:28)
==6850==    by 0x11890C: EventLoop::loop() (EventLoop.cc:121)
==6850==    by 0x10F645: main (main.cc:48)
==6850==  Block was alloc'd at
==6850==    at 0x4C2E48C: operator new(unsigned long) (vg_replace_malloc.c:334)
==6850==    by 0x112030: allocate (new_allocator.h:104)
==6850==    by 0x112030: allocate (alloc_traits.h:436)
==6850==    by 0x112030: __allocate_guarded<std::allocator<std::_Sp_counted_ptr_inplace<HttpProcessContext, std::allocator<HttpProcessContext>, (__gnu_cxx::_Lock_policy)2u> > > (allocated_ptr.h:103)
==6850==    by 0x112030: __shared_count<HttpProcessContext, std::allocator<HttpProcessContext> > (shared_ptr_base.h:613)
==6850==    by 0x112030: __shared_ptr<std::allocator<HttpProcessContext> > (shared_ptr_base.h:1100)
==6850==    by 0x112030: shared_ptr<std::allocator<HttpProcessContext> > (shared_ptr.h:319)
==6850==    by 0x112030: allocate_shared<HttpProcessContext, std::allocator<HttpProcessContext> > (shared_ptr.h:620)
==6850==    by 0x112030: make_shared<HttpProcessContext> (shared_ptr.h:636)
==6850==    by 0x112030: HttpSession::parseRcvMsg() (HttpSession.cc:224)
==6850==    by 0x115D06: HttpSession::handleMessage(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (HttpSession.cc:154)
==6850==    by 0x10E764: __invoke_impl<void, void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:227)
==6850==    by 0x10E764: __invoke<void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:251)
==6850==    by 0x10E764: operator()<std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:604)
==6850==    by 0x10E764: __call<void, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, 0ul, 1ul> (functional:934)
==6850==    by 0x10E764: operator()<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:993)
==6850==    by 0x10E764: std::_Function_handler<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_invoke(std::_Any_data const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (functional:1731)
==6850==    by 0x121C45: std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)>::operator()(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) const (functional:2127)
==6850==    by 0x120104: TcpConnection::handleRead() (TcpConnection.cc:132)
==6850==    by 0x1216CC: __invoke_impl<void, void (TcpConnection::* const&)(), TcpConnection*&> (functional:227)
==6850==    by 0x1216CC: __invoke<void (TcpConnection::* const&)(), TcpConnection*&> (functional:251)
==6850==    by 0x1216CC: operator()<TcpConnection*&> (functional:604)
==6850==    by 0x1216CC: __call<void, 0ul> (functional:934)
==6850==    by 0x1216CC: operator()<> (functional:993)
==6850==    by 0x1216CC: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpConnection::*)()> (TcpConnection*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==    by 0x10D04F: std::function<void ()>::operator()() const (functional:2127)
==6850==    by 0x10CF9D: Channel::handleEvent() (Channel.cc:28)
==6850==    by 0x11890C: EventLoop::loop() (EventLoop.cc:121)
==6850==    by 0x10F645: main (main.cc:48)
==6850== 
==6850== Invalid write of size 1
==6850==    at 0x116287: HttpSession::handleMessage(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (HttpSession.cc:194)
==6850==    by 0x10E764: __invoke_impl<void, void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:227)
==6850==    by 0x10E764: __invoke<void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:251)
==6850==    by 0x10E764: operator()<std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:604)
==6850==    by 0x10E764: __call<void, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, 0ul, 1ul> (functional:934)
==6850==    by 0x10E764: operator()<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:993)
==6850==    by 0x10E764: std::_Function_handler<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_invoke(std::_Any_data const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (functional:1731)
==6850==    by 0x121C45: std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)>::operator()(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) const (functional:2127)
==6850==    by 0x120104: TcpConnection::handleRead() (TcpConnection.cc:132)
==6850==    by 0x1216CC: __invoke_impl<void, void (TcpConnection::* const&)(), TcpConnection*&> (functional:227)
==6850==    by 0x1216CC: __invoke<void (TcpConnection::* const&)(), TcpConnection*&> (functional:251)
==6850==    by 0x1216CC: operator()<TcpConnection*&> (functional:604)
==6850==    by 0x1216CC: __call<void, 0ul> (functional:934)
==6850==    by 0x1216CC: operator()<> (functional:993)
==6850==    by 0x1216CC: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpConnection::*)()> (TcpConnection*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==    by 0x10D04F: std::function<void ()>::operator()() const (functional:2127)
==6850==    by 0x10CF9D: Channel::handleEvent() (Channel.cc:28)
==6850==    by 0x11890C: EventLoop::loop() (EventLoop.cc:121)
==6850==    by 0x10F645: main (main.cc:48)
==6850==  Address 0x5d3d2c4 is 180 bytes inside a block of size 232 free'd
==6850==    at 0x4C2F4AA: operator delete(void*) (vg_replace_malloc.c:576)
==6850==    by 0x10E98E: deallocate (new_allocator.h:110)
==6850==    by 0x10E98E: deallocate (alloc_traits.h:462)
==6850==    by 0x10E98E: ~__allocated_ptr (allocated_ptr.h:73)
==6850==    by 0x10E98E: std::_Sp_counted_ptr_inplace<HttpSession, std::allocator<HttpSession>, (__gnu_cxx::_Lock_policy)2>::_M_destroy() (shared_ptr_base.h:537)
==6850==    by 0x10EAD7: _M_release (shared_ptr_base.h:166)
==6850==    by 0x10EAD7: ~__shared_count (shared_ptr_base.h:662)
==6850==    by 0x10EAD7: ~__shared_ptr (shared_ptr_base.h:928)
==6850==    by 0x10EAD7: ~shared_ptr (shared_ptr.h:93)
==6850==    by 0x10EAD7: ~_Head_base (tuple:102)
==6850==    by 0x10EAD7: ~_Tuple_impl (tuple:180)
==6850==    by 0x10EAD7: ~tuple (tuple:866)
==6850==    by 0x10EAD7: ~_Bind (functional:918)
==6850==    by 0x10EAD7: _M_destroy (functional:1586)
==6850==    by 0x10EAD7: std::_Function_base::_Base_manager<std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_manager(std::_Any_data&, std::_Any_data const&, std::_Manager_operation) (functional:1610)
==6850==    by 0x11F0D2: ~_Function_base (functional:1690)
==6850==    by 0x11F0D2: ~function (functional:1834)
==6850==    by 0x11F0D2: TcpConnection::~TcpConnection() (TcpConnection.cc:39)
==6850==    by 0x11BF42: destroy<TcpConnection> (new_allocator.h:124)
==6850==    by 0x11BF42: destroy<TcpConnection> (alloc_traits.h:487)
==6850==    by 0x11BF42: std::_Sp_counted_ptr_inplace<TcpConnection, std::allocator<TcpConnection>, (__gnu_cxx::_Lock_policy)2>::_M_dispose() (shared_ptr_base.h:529)
==6850==    by 0x1113F3: _M_release (shared_ptr_base.h:150)
==6850==    by 0x1113F3: ~__shared_count (shared_ptr_base.h:662)
==6850==    by 0x1113F3: ~__shared_ptr (shared_ptr_base.h:928)
==6850==    by 0x1113F3: ~shared_ptr (shared_ptr.h:93)
==6850==    by 0x1113F3: HttpSession::addToBuf() (HttpSession.cc:538)
==6850==    by 0x1155C8: HttpSession::handleMessageTask(std::shared_ptr<HttpProcessContext>) (HttpSession.cc:348)
==6850==    by 0x1161B3: HttpSession::handleMessage(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (HttpSession.cc:189)
==6850==    by 0x10E764: __invoke_impl<void, void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:227)
==6850==    by 0x10E764: __invoke<void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:251)
==6850==    by 0x10E764: operator()<std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:604)
==6850==    by 0x10E764: __call<void, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, 0ul, 1ul> (functional:934)
==6850==    by 0x10E764: operator()<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:993)
==6850==    by 0x10E764: std::_Function_handler<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_invoke(std::_Any_data const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (functional:1731)
==6850==    by 0x121C45: std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)>::operator()(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) const (functional:2127)
==6850==    by 0x120104: TcpConnection::handleRead() (TcpConnection.cc:132)
==6850==    by 0x1216CC: __invoke_impl<void, void (TcpConnection::* const&)(), TcpConnection*&> (functional:227)
==6850==    by 0x1216CC: __invoke<void (TcpConnection::* const&)(), TcpConnection*&> (functional:251)
==6850==    by 0x1216CC: operator()<TcpConnection*&> (functional:604)
==6850==    by 0x1216CC: __call<void, 0ul> (functional:934)
==6850==    by 0x1216CC: operator()<> (functional:993)
==6850==    by 0x1216CC: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpConnection::*)()> (TcpConnection*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==  Block was alloc'd at
==6850==    at 0x4C2E48C: operator new(unsigned long) (vg_replace_malloc.c:334)
==6850==    by 0x10DA8F: allocate (new_allocator.h:104)
==6850==    by 0x10DA8F: allocate (alloc_traits.h:436)
==6850==    by 0x10DA8F: __allocate_guarded<std::allocator<std::_Sp_counted_ptr_inplace<HttpSession, std::allocator<HttpSession>, (__gnu_cxx::_Lock_policy)2u> > > (allocated_ptr.h:103)
==6850==    by 0x10DA8F: __shared_count<HttpSession, std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr_base.h:613)
==6850==    by 0x10DA8F: __shared_ptr<std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr_base.h:1100)
==6850==    by 0x10DA8F: shared_ptr<std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:319)
==6850==    by 0x10DA8F: allocate_shared<HttpSession, std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:620)
==6850==    by 0x10DA8F: make_shared<HttpSession, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:636)
==6850==    by 0x10DA8F: HttpServer::handleNewConnection(std::shared_ptr<TcpConnection>, EventLoop*) (HttpServer.cc:34)
==6850==    by 0x10EE32: __invoke_impl<void, void (HttpServer::* const&)(std::shared_ptr<TcpConnection>, EventLoop*), HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:227)
==6850==    by 0x10EE32: __invoke<void (HttpServer::* const&)(std::shared_ptr<TcpConnection>, EventLoop*), HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:251)
==6850==    by 0x10EE32: operator()<HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:604)
==6850==    by 0x10EE32: __call<void, std::shared_ptr<TcpConnection>&&, EventLoop*&&, 0ul, 1ul, 2ul> (functional:934)
==6850==    by 0x10EE32: operator()<std::shared_ptr<TcpConnection>, EventLoop*> (functional:993)
==6850==    by 0x10EE32: std::_Function_handler<void (std::shared_ptr<TcpConnection>, EventLoop*), std::_Bind<std::_Mem_fn<void (HttpServer::*)(std::shared_ptr<TcpConnection>, EventLoop*)> (HttpServer*, std::_Placeholder<1>, std::_Placeholder<2>)> >::_M_invoke(std::_Any_data const&, std::shared_ptr<TcpConnection>&&, EventLoop*&&) (functional:1731)
==6850==    by 0x11B365: operator() (functional:2127)
==6850==    by 0x11B365: TcpServer::onNewConnection() (TcpServer.cc:94)
==6850==    by 0x11B9D0: __invoke_impl<void, void (TcpServer::* const&)(), TcpServer*&> (functional:227)
==6850==    by 0x11B9D0: __invoke<void (TcpServer::* const&)(), TcpServer*&> (functional:251)
==6850==    by 0x11B9D0: operator()<TcpServer*&> (functional:604)
==6850==    by 0x11B9D0: __call<void, 0ul> (functional:934)
==6850==    by 0x11B9D0: operator()<> (functional:993)
==6850==    by 0x11B9D0: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpServer::*)()> (TcpServer*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==    by 0x10D04F: std::function<void ()>::operator()() const (functional:2127)
==6850==    by 0x10CF9D: Channel::handleEvent() (Channel.cc:28)
==6850==    by 0x11890C: EventLoop::loop() (EventLoop.cc:121)
==6850==    by 0x10F645: main (main.cc:48)
==6850== 
==6850== Invalid read of size 8
==6850==    at 0x115CDF: HttpSession::handleMessage(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (HttpSession.cc:152)
==6850==    by 0x10E764: __invoke_impl<void, void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:227)
==6850==    by 0x10E764: __invoke<void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:251)
==6850==    by 0x10E764: operator()<std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:604)
==6850==    by 0x10E764: __call<void, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, 0ul, 1ul> (functional:934)
==6850==    by 0x10E764: operator()<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:993)
==6850==    by 0x10E764: std::_Function_handler<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_invoke(std::_Any_data const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (functional:1731)
==6850==    by 0x121C45: std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)>::operator()(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) const (functional:2127)
==6850==    by 0x120104: TcpConnection::handleRead() (TcpConnection.cc:132)
==6850==    by 0x1216CC: __invoke_impl<void, void (TcpConnection::* const&)(), TcpConnection*&> (functional:227)
==6850==    by 0x1216CC: __invoke<void (TcpConnection::* const&)(), TcpConnection*&> (functional:251)
==6850==    by 0x1216CC: operator()<TcpConnection*&> (functional:604)
==6850==    by 0x1216CC: __call<void, 0ul> (functional:934)
==6850==    by 0x1216CC: operator()<> (functional:993)
==6850==    by 0x1216CC: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpConnection::*)()> (TcpConnection*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==    by 0x10D04F: std::function<void ()>::operator()() const (functional:2127)
==6850==    by 0x10CF9D: Channel::handleEvent() (Channel.cc:28)
==6850==    by 0x11890C: EventLoop::loop() (EventLoop.cc:121)
==6850==    by 0x10F645: main (main.cc:48)
==6850==  Address 0x5d3d2d0 is 192 bytes inside a block of size 232 free'd
==6850==    at 0x4C2F4AA: operator delete(void*) (vg_replace_malloc.c:576)
==6850==    by 0x10E98E: deallocate (new_allocator.h:110)
==6850==    by 0x10E98E: deallocate (alloc_traits.h:462)
==6850==    by 0x10E98E: ~__allocated_ptr (allocated_ptr.h:73)
==6850==    by 0x10E98E: std::_Sp_counted_ptr_inplace<HttpSession, std::allocator<HttpSession>, (__gnu_cxx::_Lock_policy)2>::_M_destroy() (shared_ptr_base.h:537)
==6850==    by 0x10EAD7: _M_release (shared_ptr_base.h:166)
==6850==    by 0x10EAD7: ~__shared_count (shared_ptr_base.h:662)
==6850==    by 0x10EAD7: ~__shared_ptr (shared_ptr_base.h:928)
==6850==    by 0x10EAD7: ~shared_ptr (shared_ptr.h:93)
==6850==    by 0x10EAD7: ~_Head_base (tuple:102)
==6850==    by 0x10EAD7: ~_Tuple_impl (tuple:180)
==6850==    by 0x10EAD7: ~tuple (tuple:866)
==6850==    by 0x10EAD7: ~_Bind (functional:918)
==6850==    by 0x10EAD7: _M_destroy (functional:1586)
==6850==    by 0x10EAD7: std::_Function_base::_Base_manager<std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_manager(std::_Any_data&, std::_Any_data const&, std::_Manager_operation) (functional:1610)
==6850==    by 0x11F0D2: ~_Function_base (functional:1690)
==6850==    by 0x11F0D2: ~function (functional:1834)
==6850==    by 0x11F0D2: TcpConnection::~TcpConnection() (TcpConnection.cc:39)
==6850==    by 0x11BF42: destroy<TcpConnection> (new_allocator.h:124)
==6850==    by 0x11BF42: destroy<TcpConnection> (alloc_traits.h:487)
==6850==    by 0x11BF42: std::_Sp_counted_ptr_inplace<TcpConnection, std::allocator<TcpConnection>, (__gnu_cxx::_Lock_policy)2>::_M_dispose() (shared_ptr_base.h:529)
==6850==    by 0x1113F3: _M_release (shared_ptr_base.h:150)
==6850==    by 0x1113F3: ~__shared_count (shared_ptr_base.h:662)
==6850==    by 0x1113F3: ~__shared_ptr (shared_ptr_base.h:928)
==6850==    by 0x1113F3: ~shared_ptr (shared_ptr.h:93)
==6850==    by 0x1113F3: HttpSession::addToBuf() (HttpSession.cc:538)
==6850==    by 0x1155C8: HttpSession::handleMessageTask(std::shared_ptr<HttpProcessContext>) (HttpSession.cc:348)
==6850==    by 0x1161B3: HttpSession::handleMessage(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (HttpSession.cc:189)
==6850==    by 0x10E764: __invoke_impl<void, void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:227)
==6850==    by 0x10E764: __invoke<void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:251)
==6850==    by 0x10E764: operator()<std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:604)
==6850==    by 0x10E764: __call<void, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, 0ul, 1ul> (functional:934)
==6850==    by 0x10E764: operator()<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:993)
==6850==    by 0x10E764: std::_Function_handler<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_invoke(std::_Any_data const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (functional:1731)
==6850==    by 0x121C45: std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)>::operator()(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) const (functional:2127)
==6850==    by 0x120104: TcpConnection::handleRead() (TcpConnection.cc:132)
==6850==    by 0x1216CC: __invoke_impl<void, void (TcpConnection::* const&)(), TcpConnection*&> (functional:227)
==6850==    by 0x1216CC: __invoke<void (TcpConnection::* const&)(), TcpConnection*&> (functional:251)
==6850==    by 0x1216CC: operator()<TcpConnection*&> (functional:604)
==6850==    by 0x1216CC: __call<void, 0ul> (functional:934)
==6850==    by 0x1216CC: operator()<> (functional:993)
==6850==    by 0x1216CC: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpConnection::*)()> (TcpConnection*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==  Block was alloc'd at
==6850==    at 0x4C2E48C: operator new(unsigned long) (vg_replace_malloc.c:334)
==6850==    by 0x10DA8F: allocate (new_allocator.h:104)
==6850==    by 0x10DA8F: allocate (alloc_traits.h:436)
==6850==    by 0x10DA8F: __allocate_guarded<std::allocator<std::_Sp_counted_ptr_inplace<HttpSession, std::allocator<HttpSession>, (__gnu_cxx::_Lock_policy)2u> > > (allocated_ptr.h:103)
==6850==    by 0x10DA8F: __shared_count<HttpSession, std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr_base.h:613)
==6850==    by 0x10DA8F: __shared_ptr<std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr_base.h:1100)
==6850==    by 0x10DA8F: shared_ptr<std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:319)
==6850==    by 0x10DA8F: allocate_shared<HttpSession, std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:620)
==6850==    by 0x10DA8F: make_shared<HttpSession, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:636)
==6850==    by 0x10DA8F: HttpServer::handleNewConnection(std::shared_ptr<TcpConnection>, EventLoop*) (HttpServer.cc:34)
==6850==    by 0x10EE32: __invoke_impl<void, void (HttpServer::* const&)(std::shared_ptr<TcpConnection>, EventLoop*), HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:227)
==6850==    by 0x10EE32: __invoke<void (HttpServer::* const&)(std::shared_ptr<TcpConnection>, EventLoop*), HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:251)
==6850==    by 0x10EE32: operator()<HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:604)
==6850==    by 0x10EE32: __call<void, std::shared_ptr<TcpConnection>&&, EventLoop*&&, 0ul, 1ul, 2ul> (functional:934)
==6850==    by 0x10EE32: operator()<std::shared_ptr<TcpConnection>, EventLoop*> (functional:993)
==6850==    by 0x10EE32: std::_Function_handler<void (std::shared_ptr<TcpConnection>, EventLoop*), std::_Bind<std::_Mem_fn<void (HttpServer::*)(std::shared_ptr<TcpConnection>, EventLoop*)> (HttpServer*, std::_Placeholder<1>, std::_Placeholder<2>)> >::_M_invoke(std::_Any_data const&, std::shared_ptr<TcpConnection>&&, EventLoop*&&) (functional:1731)
==6850==    by 0x11B365: operator() (functional:2127)
==6850==    by 0x11B365: TcpServer::onNewConnection() (TcpServer.cc:94)
==6850==    by 0x11B9D0: __invoke_impl<void, void (TcpServer::* const&)(), TcpServer*&> (functional:227)
==6850==    by 0x11B9D0: __invoke<void (TcpServer::* const&)(), TcpServer*&> (functional:251)
==6850==    by 0x11B9D0: operator()<TcpServer*&> (functional:604)
==6850==    by 0x11B9D0: __call<void, 0ul> (functional:934)
==6850==    by 0x11B9D0: operator()<> (functional:993)
==6850==    by 0x11B9D0: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpServer::*)()> (TcpServer*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==    by 0x10D04F: std::function<void ()>::operator()() const (functional:2127)
==6850==    by 0x10CF9D: Channel::handleEvent() (Channel.cc:28)
==6850==    by 0x11890C: EventLoop::loop() (EventLoop.cc:121)
==6850==    by 0x10F645: main (main.cc:48)
==6850== 
==6850== Invalid read of size 8
==6850==    at 0x115CE9: HttpSession::handleMessage(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (HttpSession.cc:151)
==6850==    by 0x10E764: __invoke_impl<void, void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:227)
==6850==    by 0x10E764: __invoke<void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:251)
==6850==    by 0x10E764: operator()<std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:604)
==6850==    by 0x10E764: __call<void, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, 0ul, 1ul> (functional:934)
==6850==    by 0x10E764: operator()<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:993)
==6850==    by 0x10E764: std::_Function_handler<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_invoke(std::_Any_data const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (functional:1731)
==6850==    by 0x121C45: std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)>::operator()(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) const (functional:2127)
==6850==    by 0x120104: TcpConnection::handleRead() (TcpConnection.cc:132)
==6850==    by 0x1216CC: __invoke_impl<void, void (TcpConnection::* const&)(), TcpConnection*&> (functional:227)
==6850==    by 0x1216CC: __invoke<void (TcpConnection::* const&)(), TcpConnection*&> (functional:251)
==6850==    by 0x1216CC: operator()<TcpConnection*&> (functional:604)
==6850==    by 0x1216CC: __call<void, 0ul> (functional:934)
==6850==    by 0x1216CC: operator()<> (functional:993)
==6850==    by 0x1216CC: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpConnection::*)()> (TcpConnection*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==    by 0x10D04F: std::function<void ()>::operator()() const (functional:2127)
==6850==    by 0x10CF9D: Channel::handleEvent() (Channel.cc:28)
==6850==    by 0x11890C: EventLoop::loop() (EventLoop.cc:121)
==6850==    by 0x10F645: main (main.cc:48)
==6850==  Address 0x5d3d290 is 128 bytes inside a block of size 232 free'd
==6850==    at 0x4C2F4AA: operator delete(void*) (vg_replace_malloc.c:576)
==6850==    by 0x10E98E: deallocate (new_allocator.h:110)
==6850==    by 0x10E98E: deallocate (alloc_traits.h:462)
==6850==    by 0x10E98E: ~__allocated_ptr (allocated_ptr.h:73)
==6850==    by 0x10E98E: std::_Sp_counted_ptr_inplace<HttpSession, std::allocator<HttpSession>, (__gnu_cxx::_Lock_policy)2>::_M_destroy() (shared_ptr_base.h:537)
==6850==    by 0x10EAD7: _M_release (shared_ptr_base.h:166)
==6850==    by 0x10EAD7: ~__shared_count (shared_ptr_base.h:662)
==6850==    by 0x10EAD7: ~__shared_ptr (shared_ptr_base.h:928)
==6850==    by 0x10EAD7: ~shared_ptr (shared_ptr.h:93)
==6850==    by 0x10EAD7: ~_Head_base (tuple:102)
==6850==    by 0x10EAD7: ~_Tuple_impl (tuple:180)
==6850==    by 0x10EAD7: ~tuple (tuple:866)
==6850==    by 0x10EAD7: ~_Bind (functional:918)
==6850==    by 0x10EAD7: _M_destroy (functional:1586)
==6850==    by 0x10EAD7: std::_Function_base::_Base_manager<std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_manager(std::_Any_data&, std::_Any_data const&, std::_Manager_operation) (functional:1610)
==6850==    by 0x11F0D2: ~_Function_base (functional:1690)
==6850==    by 0x11F0D2: ~function (functional:1834)
==6850==    by 0x11F0D2: TcpConnection::~TcpConnection() (TcpConnection.cc:39)
==6850==    by 0x11BF42: destroy<TcpConnection> (new_allocator.h:124)
==6850==    by 0x11BF42: destroy<TcpConnection> (alloc_traits.h:487)
==6850==    by 0x11BF42: std::_Sp_counted_ptr_inplace<TcpConnection, std::allocator<TcpConnection>, (__gnu_cxx::_Lock_policy)2>::_M_dispose() (shared_ptr_base.h:529)
==6850==    by 0x1113F3: _M_release (shared_ptr_base.h:150)
==6850==    by 0x1113F3: ~__shared_count (shared_ptr_base.h:662)
==6850==    by 0x1113F3: ~__shared_ptr (shared_ptr_base.h:928)
==6850==    by 0x1113F3: ~shared_ptr (shared_ptr.h:93)
==6850==    by 0x1113F3: HttpSession::addToBuf() (HttpSession.cc:538)
==6850==    by 0x1155C8: HttpSession::handleMessageTask(std::shared_ptr<HttpProcessContext>) (HttpSession.cc:348)
==6850==    by 0x1161B3: HttpSession::handleMessage(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (HttpSession.cc:189)
==6850==    by 0x10E764: __invoke_impl<void, void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:227)
==6850==    by 0x10E764: __invoke<void (HttpSession::* const&)(std::__cxx11::basic_string<char>&), std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:251)
==6850==    by 0x10E764: operator()<std::shared_ptr<HttpSession>&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:604)
==6850==    by 0x10E764: __call<void, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, 0ul, 1ul> (functional:934)
==6850==    by 0x10E764: operator()<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&> (functional:993)
==6850==    by 0x10E764: std::_Function_handler<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&), std::_Bind<std::_Mem_fn<void (HttpSession::*)(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)> (std::shared_ptr<HttpSession>, std::_Placeholder<1>)> >::_M_invoke(std::_Any_data const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) (functional:1731)
==6850==    by 0x121C45: std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&)>::operator()(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&) const (functional:2127)
==6850==    by 0x120104: TcpConnection::handleRead() (TcpConnection.cc:132)
==6850==    by 0x1216CC: __invoke_impl<void, void (TcpConnection::* const&)(), TcpConnection*&> (functional:227)
==6850==    by 0x1216CC: __invoke<void (TcpConnection::* const&)(), TcpConnection*&> (functional:251)
==6850==    by 0x1216CC: operator()<TcpConnection*&> (functional:604)
==6850==    by 0x1216CC: __call<void, 0ul> (functional:934)
==6850==    by 0x1216CC: operator()<> (functional:993)
==6850==    by 0x1216CC: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpConnection::*)()> (TcpConnection*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==  Block was alloc'd at
==6850==    at 0x4C2E48C: operator new(unsigned long) (vg_replace_malloc.c:334)
==6850==    by 0x10DA8F: allocate (new_allocator.h:104)
==6850==    by 0x10DA8F: allocate (alloc_traits.h:436)
==6850==    by 0x10DA8F: __allocate_guarded<std::allocator<std::_Sp_counted_ptr_inplace<HttpSession, std::allocator<HttpSession>, (__gnu_cxx::_Lock_policy)2u> > > (allocated_ptr.h:103)
==6850==    by 0x10DA8F: __shared_count<HttpSession, std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr_base.h:613)
==6850==    by 0x10DA8F: __shared_ptr<std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr_base.h:1100)
==6850==    by 0x10DA8F: shared_ptr<std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:319)
==6850==    by 0x10DA8F: allocate_shared<HttpSession, std::allocator<HttpSession>, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:620)
==6850==    by 0x10DA8F: make_shared<HttpSession, std::shared_ptr<TcpConnection>&, EventLoop*&> (shared_ptr.h:636)
==6850==    by 0x10DA8F: HttpServer::handleNewConnection(std::shared_ptr<TcpConnection>, EventLoop*) (HttpServer.cc:34)
==6850==    by 0x10EE32: __invoke_impl<void, void (HttpServer::* const&)(std::shared_ptr<TcpConnection>, EventLoop*), HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:227)
==6850==    by 0x10EE32: __invoke<void (HttpServer::* const&)(std::shared_ptr<TcpConnection>, EventLoop*), HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:251)
==6850==    by 0x10EE32: operator()<HttpServer*&, std::shared_ptr<TcpConnection>, EventLoop*> (functional:604)
==6850==    by 0x10EE32: __call<void, std::shared_ptr<TcpConnection>&&, EventLoop*&&, 0ul, 1ul, 2ul> (functional:934)
==6850==    by 0x10EE32: operator()<std::shared_ptr<TcpConnection>, EventLoop*> (functional:993)
==6850==    by 0x10EE32: std::_Function_handler<void (std::shared_ptr<TcpConnection>, EventLoop*), std::_Bind<std::_Mem_fn<void (HttpServer::*)(std::shared_ptr<TcpConnection>, EventLoop*)> (HttpServer*, std::_Placeholder<1>, std::_Placeholder<2>)> >::_M_invoke(std::_Any_data const&, std::shared_ptr<TcpConnection>&&, EventLoop*&&) (functional:1731)
==6850==    by 0x11B365: operator() (functional:2127)
==6850==    by 0x11B365: TcpServer::onNewConnection() (TcpServer.cc:94)
==6850==    by 0x11B9D0: __invoke_impl<void, void (TcpServer::* const&)(), TcpServer*&> (functional:227)
==6850==    by 0x11B9D0: __invoke<void (TcpServer::* const&)(), TcpServer*&> (functional:251)
==6850==    by 0x11B9D0: operator()<TcpServer*&> (functional:604)
==6850==    by 0x11B9D0: __call<void, 0ul> (functional:934)
==6850==    by 0x11B9D0: operator()<> (functional:993)
==6850==    by 0x11B9D0: std::_Function_handler<void (), std::_Bind<std::_Mem_fn<void (TcpServer::*)()> (TcpServer*)> >::_M_invoke(std::_Any_data const&) (functional:1731)
==6850==    by 0x10D04F: std::function<void ()>::operator()() const (functional:2127)
==6850==    by 0x10CF9D: Channel::handleEvent() (Channel.cc:28)
==6850==    by 0x11890C: EventLoop::loop() (EventLoop.cc:121)
==6850==    by 0x10F645: main (main.cc:48)
==6850== 
==6850== 
==6850== Process terminating with default action of signal 2 (SIGINT)
==6850==    at 0x5701353: __epoll_wait_nocancel (syscall-template.S:84)
==6850==    by 0x10FBAE: Epoller::epoll(std::vector<std::shared_ptr<Channel>, std::allocator<std::shared_ptr<Channel> > >&) (Epoller.cc:48)
==6850==    by 0x118A59: EventLoop::loop() (EventLoop.cc:117)
==6850==    by 0x10F645: main (main.cc:48)
==6850== 
==6850== HEAP SUMMARY:
==6850==     in use at exit: 370,568 bytes in 18 blocks
==6850==   total heap usage: 63,658 allocs, 63,640 frees, 23,876,724 bytes allocated
==6850== 
==6850== LEAK SUMMARY:
==6850==    definitely lost: 0 bytes in 0 blocks
==6850==    indirectly lost: 0 bytes in 0 blocks
==6850==      possibly lost: 0 bytes in 0 blocks
==6850==    still reachable: 370,568 bytes in 18 blocks
==6850==         suppressed: 0 bytes in 0 blocks
==6850== Reachable blocks (those to which a pointer was found) are not shown.
==6850== To see them, rerun with: --leak-check=full --show-leak-kinds=all
==6850== 
==6850== For counts of detected and suppressed errors, rerun with: -v
==6850== ERROR SUMMARY: 44 errors from 9 contexts (suppressed: 0 from 0)
